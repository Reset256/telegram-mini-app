<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h3>Введите текст</h3>
  <input id="textInput" placeholder="Напиши что-нибудь" />
  <button onclick="send()">Отправить</button>

  <script>
    // Глобальная функция
    function send() {
      const text = document.getElementById("textInput").value;
      const user = window.Telegram.WebApp.initDataUnsafe?.user;

      if (!user) {
        alert("Ошибка: user undefined. Откройте Mini App через кнопку бота!");
        return;
      }

      fetch("https://unmulcted-dobsonfly-modesta.ngrok-free.dev/send-message", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          text,
          userId: user.id
        })
      })
      .then(r => r.json())
      .then(r => {
        console.log("Backend response:", r);
        // ✅ Очищаем поле после успешной отправки
        input.value = "";
      })
      .catch(e => console.error("Fetch error:", e));
    }

    // Инициализация Telegram WebApp
    window.Telegram.WebApp.ready();
  </script>
</body>
</html>
